\doxysection{C\+:/\+Users/gallo/\+One\+Drive/\+Documents/\+SAé-\/casali/\+SAE\+\_\+\+TV\+\_\+\+CONNECTEES/public/wp-\/content/plugins/plugin-\/ecran-\/connecte/src/controllers/\+Alert\+Rest\+Controller.\+php}
\hypertarget{_c_1_2_users_2gallo_2_one_drive_2_documents_2_s_a_xC3_xA9-casali_2_s_a_e__t_v__c_o_n_n_e_c_t_e_eda47139275ff0a1d34803b4c9b6543da}{}\label{_c_1_2_users_2gallo_2_one_drive_2_documents_2_s_a_xC3_xA9-casali_2_s_a_e__t_v__c_o_n_n_e_c_t_e_eda47139275ff0a1d34803b4c9b6543da}Initialise l\textquotesingle{}API REST pour la gestion des alertes.

Ce constructeur définit le namespace et le chemin de base pour les routes REST liées aux alertes. Ces informations sont utilisées pour enregistrer les routes de l\textquotesingle{}API dans Word\+Press.

\begin{DoxyReturn}{Renvoie}
void
\end{DoxyReturn}
// Initialiser l\textquotesingle{}API REST pour les alertes \+: \$alert\+Controller = new Alert\+Controller();

\begin{DoxyVersion}{Version}
1.\+0 
\end{DoxyVersion}
\begin{DoxyDate}{Date}
16-\/09-\/2024
\end{DoxyDate}

\begin{DoxyCodeInclude}{0}
\DoxyCodeLine{<?php}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{keyword}{namespace\ }\mbox{\hyperlink{namespace_controllers}{Controllers}};}
\DoxyCodeLine{}
\DoxyCodeLine{include\ \_\_DIR\_\_\ .\ \textcolor{stringliteral}{'/../utils/OneSignalPush.php'};}
\DoxyCodeLine{}
\DoxyCodeLine{use\ \mbox{\hyperlink{class_models_1_1_alert}{Models\(\backslash\)Alert}};}
\DoxyCodeLine{use\ \mbox{\hyperlink{class_models_1_1_code_ade}{Models\(\backslash\)CodeAde}};}
\DoxyCodeLine{use\ \mbox{\hyperlink{class_utils_1_1_one_signal_push}{Utils\(\backslash\)OneSignalPush}};}
\DoxyCodeLine{use\ WP\_Error;}
\DoxyCodeLine{use\ WP\_REST\_Controller;}
\DoxyCodeLine{use\ WP\_REST\_Request;}
\DoxyCodeLine{use\ WP\_REST\_Response;}
\DoxyCodeLine{use\ WP\_REST\_Server;}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{keyword}{class\ }AlertRestController\ \textcolor{keyword}{extends}\ WP\_REST\_Controller}
\DoxyCodeLine{\{}
\DoxyCodeLine{\ \ \ \ \textcolor{keyword}{public}\ \textcolor{keyword}{function}\ \_\_construct()\ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \$this-\/>\textcolor{keyword}{namespace\ }=\ 'amu-\/ecran-\/connectee/v1';}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \$this-\/>rest\_base\ =\ \textcolor{stringliteral}{'alert'};}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \textcolor{keyword}{public}\ \textcolor{keyword}{function}\ register\_routes()\ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ register\_rest\_route(}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \$this-\/>\textcolor{keyword}{namespace},}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{charliteral}{'/'}\ .\ \$this-\/>rest\_base,}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ array(}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ array(}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{'methods'}\ =>\ WP\_REST\_Server::READABLE,}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{'callback'}\ =>\ array(\$this,\ \textcolor{stringliteral}{'get\_items'}),}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{'permission\_callback'}\ =>\ array(\$this,\ \textcolor{stringliteral}{'get\_items\_permissions\_check'}),}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{'args'}\ =>\ array(),}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ),}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ array(}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{'methods'}\ =>\ WP\_REST\_Server::CREATABLE,}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{'callback'}\ =>\ array(\$this,\ \textcolor{stringliteral}{'create\_item'}),}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{'permission\_callback'}\ =>\ array(\$this,\ \textcolor{stringliteral}{'create\_item\_permissions\_check'}),}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{'args'}\ =>\ array(}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{'content'}\ =>\ array(}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{'type'}\ =>\ \textcolor{stringliteral}{'string'},}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{'required'}\ =>\ \textcolor{keyword}{true},}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{'description'}\ =>\ \_\_(\textcolor{stringliteral}{'Alert\ content'}),}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ),}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{'expiration-\/date'}\ =>\ array(}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{'type'}\ =>\ \textcolor{stringliteral}{'string'},}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{'required'}\ =>\ \textcolor{keyword}{true},}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{'description'}\ =>\ \_\_(\textcolor{stringliteral}{'Alert\ expiration\ date'}),}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ),}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{'codes'}\ =>\ array(}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{'type'}\ \ \ \ \ \ \ \ =>\ \textcolor{stringliteral}{'array'},}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{'required'}\ \ \ \ =>\ \textcolor{keyword}{true},}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{'items'}\ \ \ \ \ \ \ =>\ array(\ \textcolor{stringliteral}{'type'}\ =>\ \textcolor{stringliteral}{'string'}\ ),}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{'description'}\ =>\ \_\_(\textcolor{stringliteral}{'ADE\ codes'}),}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ),}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ),}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ),}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{'schema'}\ =>\ array(\$this,\ \textcolor{stringliteral}{'get\_public\_item\_schema'}),}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ )}
\DoxyCodeLine{\ \ \ \ \ \ \ \ );}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ register\_rest\_route(}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \$this-\/>\textcolor{keyword}{namespace},}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{charliteral}{'/'}\ .\ \$this-\/>rest\_base\ .\ \textcolor{stringliteral}{'/(?P<id>[\(\backslash\)d]+)'},}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ array(}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{'args'}\ =>\ array(}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{'id'}\ =>\ array(}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{'description'}\ =>\ \_\_(\textcolor{stringliteral}{'Unique\ identifier\ for\ the\ alert'}),}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{'type'}\ =>\ \textcolor{stringliteral}{'integer'},}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ),}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ),}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ array(}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{'methods'}\ =>\ WP\_REST\_Server::READABLE,}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{'callback'}\ =>\ array(\$this,\ \textcolor{stringliteral}{'get\_item'}),}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{'permission\_callback'}\ =>\ array(\$this,\ \textcolor{stringliteral}{'get\_item\_permissions\_check'}),}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{'args'}\ =>\ \textcolor{keyword}{null},}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ),}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ array(}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{'methods'}\ =>\ WP\_REST\_Server::EDITABLE,}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{'callback'}\ =>\ array(\$this,\ \textcolor{stringliteral}{'update\_item'}),}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{'permission\_callback'}\ =>\ array(\$this,\ \textcolor{stringliteral}{'update\_item\_permissions\_check'}),}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{'args'}\ =>\ array(}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{'content'}\ =>\ array(}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{'type'}\ =>\ \textcolor{stringliteral}{'string'},}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{'description'}\ =>\ \_\_(\textcolor{stringliteral}{'Alert\ content'}),}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ),}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{'expiration-\/date'}\ =>\ array(}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{'type'}\ =>\ \textcolor{stringliteral}{'string'},}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{'description'}\ =>\ \_\_(\textcolor{stringliteral}{'Alert\ expiration\ date'}),}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ),}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{'codes'}\ =>\ array(}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{'type'}\ \ \ \ \ \ \ \ =>\ \textcolor{stringliteral}{'array'},}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{'items'}\ \ \ \ \ \ \ =>\ array(\ \textcolor{stringliteral}{'type'}\ =>\ \textcolor{stringliteral}{'string'}\ ),}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{'description'}\ =>\ \_\_(\textcolor{stringliteral}{'ADE\ codes'}),}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ),}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ),}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ),}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ array(}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{'methods'}\ =>\ WP\_REST\_Server::DELETABLE,}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{'callback'}\ =>\ array(\$this,\ \textcolor{stringliteral}{'delete\_item'}),}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{'permission\_callback'}\ =>\ array(\$this,\ \textcolor{stringliteral}{'delete\_item\_permissions\_check'}),}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{'args'}\ =>\ array()}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ),}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{'schema'}\ =>\ array(\$this,\ \textcolor{stringliteral}{'get\_public\_item\_schema'}),}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ )}
\DoxyCodeLine{\ \ \ \ \ \ \ \ );}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \textcolor{keyword}{public}\ \textcolor{keyword}{function}\ get\_items(\$request)\ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{comment}{//\ Obtenir\ une\ instance\ du\ gestionnaire\ de\ codes\ ADE}}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \$alert\ =\ \textcolor{keyword}{new}\ Alert();}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{new}\ WP\_REST\_Response(\$alert-\/>getList(),\ 200);}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \textcolor{keyword}{public}\ \textcolor{keyword}{function}\ create\_item(\$request)\ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{comment}{//\ Obtenir\ une\ instance\ du\ gestionnaire\ d'alertes}}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \$alert\ =\ \textcolor{keyword}{new}\ Alert();}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{comment}{//\ Définir\ les\ données\ de\ l'alerte}}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \$alert-\/>setAuthor(wp\_get\_current\_user()-\/>ID);}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \$alert-\/>setContent(\$request-\/>get\_param(\textcolor{stringliteral}{'content'}));}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \$alert-\/>setCreationDate(date(\textcolor{stringliteral}{'Y-\/m-\/d'}));}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \$alert-\/>setExpirationDate(\$request-\/>get\_param(\textcolor{stringliteral}{'expiration-\/date'}));}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{comment}{//\ Définir\ les\ codes\ ADE\ pour\ l'alerte}}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \$ade\_codes\ =\ \$this-\/>find\_ade\_codes(\$alert,\ \$request-\/>get\_json\_params()[\textcolor{stringliteral}{'codes'}]);}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (is\_null(\$ade\_codes))}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{new}\ WP\_REST\_Response(array(\textcolor{stringliteral}{'message'}\ =>\ \textcolor{stringliteral}{'An\ invalid\ code\ was\ specified'}),\ 400);}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \$alert-\/>setCodes(\$ade\_codes);}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{comment}{//\ Essayer\ d'insérer\ le\ code\ ADE}}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ ((\$insert\_id\ =\ \$alert-\/>insert()))\ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Envoyer\ la\ notification\ push}}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \$oneSignalPush\ =\ \textcolor{keyword}{new}\ OneSignalPush();}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\$alert-\/>isForEveryone())\ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \$oneSignalPush-\/>sendNotification(\textcolor{keyword}{null},\ \$alert-\/>getContent());}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \$oneSignalPush-\/>sendNotification(\$ade\_codes,\ \$alert-\/>getContent());}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Retourner\ l'ID\ de\ l'alerte\ insérée}}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{new}\ WP\_REST\_Response(array(\textcolor{stringliteral}{'id'}\ =>\ \$insert\_id),\ 200);}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{new}\ WP\_REST\_Response(array(\textcolor{stringliteral}{'message'}\ =>\ \textcolor{stringliteral}{'Could\ not\ insert\ the\ alert'}),\ 400);}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \textcolor{keyword}{public}\ \textcolor{keyword}{function}\ get\_item(\$request)\ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{comment}{//\ Obtenir\ une\ instance\ du\ gestionnaire\ d'alertes}}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \$alert\ =\ \textcolor{keyword}{new}\ Alert();}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{comment}{//\ Récupérer\ les\ informations\ de\ la\ base\ de\ données}}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \$requested\_alert\ =\ \$alert-\/>get(\$request-\/>get\_param(\textcolor{stringliteral}{'id'}));}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!\$requested\_alert)}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{new}\ WP\_REST\_Response(array(\textcolor{stringliteral}{'message'}\ =>\ \textcolor{stringliteral}{'Alert\ not\ found'}),\ 404);}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{new}\ WP\_REST\_Response(\$requested\_alert,\ 200);}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \textcolor{keyword}{public}\ \textcolor{keyword}{function}\ update\_item(\$request)\ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{comment}{//\ Obtenir\ une\ instance\ du\ gestionnaire\ d'alertes}}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \$alert\ =\ \textcolor{keyword}{new}\ Alert();}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{comment}{//\ Récupérer\ les\ informations\ de\ la\ base\ de\ données}}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \$requested\_alert\ =\ \$alert-\/>get(\$request-\/>get\_param(\textcolor{stringliteral}{'id'}));}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (is\_null(\$requested\_alert-\/>getId()))}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{new}\ WP\_REST\_Response(array(\textcolor{stringliteral}{'message'}\ =>\ \textcolor{stringliteral}{'Alert\ not\ found'}),\ 404);}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{comment}{//\ Mettre\ à\ jour\ les\ données\ de\ l'alerte}}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (is\_string(\$request-\/>get\_json\_params()[\textcolor{stringliteral}{'content'}]))}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \$requested\_alert-\/>setContent(\$request-\/>get\_json\_params()[\textcolor{stringliteral}{'content'}]);}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (is\_string(\$request-\/>get\_json\_params()[\textcolor{stringliteral}{'expiration-\/date'}]))}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \$requested\_alert-\/>setExpirationDate(\$request-\/>get\_json\_params()[\textcolor{stringliteral}{'expiration-\/date'}]);}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (is\_array(\$request-\/>get\_json\_params()[\textcolor{stringliteral}{'codes'}]))\ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \$ade\_codes\ =\ \$this-\/>find\_ade\_codes(\$requested\_alert,\ \$request-\/>get\_json\_params()[\textcolor{stringliteral}{'codes'}]);}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (is\_null(\$ade\_codes))}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{new}\ WP\_REST\_Response(array(\textcolor{stringliteral}{'message'}\ =>\ \textcolor{stringliteral}{'An\ invalid\ code\ was\ specified'}),\ 400);}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \$requested\_alert-\/>setCodes(\$ade\_codes);}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{comment}{//\ Essayer\ de\ mettre\ à\ jour\ les\ informations}}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\$requested\_alert-\/>update()\ >\ 0)}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{new}\ WP\_REST\_Response(\textcolor{keyword}{null},\ 200);}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{new}\ WP\_REST\_Response(array(\textcolor{stringliteral}{'message'}\ =>\ \textcolor{stringliteral}{'Could\ not\ update\ the\ alert'}),\ 400);}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \textcolor{keyword}{public}\ \textcolor{keyword}{function}\ delete\_item(\$request)\ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{comment}{//\ Obtenir\ une\ instance\ du\ gestionnaire\ d'alertes}}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \$alert\ =\ \textcolor{keyword}{new}\ Alert();}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{comment}{//\ Récupérer\ les\ informations\ de\ la\ base\ de\ données}}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \$requested\_alert\ =\ \$alert-\/>get(\$request-\/>get\_param(\textcolor{stringliteral}{'id'}));}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\$requested\_alert\ \&\&\ \$requested\_alert-\/>delete())}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{new}\ WP\_REST\_Response(\textcolor{keyword}{null},\ 200);}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{new}\ WP\_REST\_Response(array(\textcolor{stringliteral}{'message'}\ =>\ \textcolor{stringliteral}{'Could\ not\ delete\ the\ alert'}),\ 400);}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{}
\DoxyCodeLine{*}
\DoxyCodeLine{\ \ \ \ \textcolor{keyword}{public}\ \textcolor{keyword}{function}\ get\_items\_permissions\_check(\$request)\ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \$current\_user\ =\ wp\_get\_current\_user();}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ in\_array(\textcolor{stringliteral}{"{}administrator"{}},\ \$current\_user-\/>roles);}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \textcolor{keyword}{public}\ \textcolor{keyword}{function}\ create\_item\_permissions\_check(\$request)\ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \$this-\/>get\_items\_permissions\_check(\$request);}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \textcolor{keyword}{public}\ \textcolor{keyword}{function}\ get\_item\_permissions\_check(\$request)\ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \$this-\/>get\_items\_permissions\_check(\$request);}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \textcolor{keyword}{public}\ \textcolor{keyword}{function}\ update\_item\_permissions\_check(\$request)\ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \$this-\/>get\_items\_permissions\_check(\$request);}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \textcolor{keyword}{public}\ \textcolor{keyword}{function}\ delete\_item\_permissions\_check(\$request)\ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \$this-\/>get\_items\_permissions\_check(\$request);}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \textcolor{keyword}{private}\ \textcolor{keyword}{function}\ find\_ade\_codes(\$alert,\ \$codes)\ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{comment}{//\ Trouver\ les\ codes\ ADE}}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \$ade\_code\ =\ \textcolor{keyword}{new}\ CodeAde();}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \$alert-\/>setForEveryone(0);}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \$ade\_codes\ =\ array();}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{keywordflow}{foreach}\ (\$codes\ as\ \$code)\ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\$code\ ==\ \textcolor{stringliteral}{'all'})\ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \$alert-\/>setForEveryone(1);}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (\$code\ !=\ 0)\ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (is\_null(\$ade\_code-\/>getByCode(\$code)-\/>getId()))\ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{null};}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \$ade\_codes[]\ =\ \$ade\_code-\/>getByCode(\$code);}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{null};}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \$ade\_codes;}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{\}}

\end{DoxyCodeInclude}
 